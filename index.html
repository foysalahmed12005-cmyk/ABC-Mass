<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ABC MASS Manager</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
    body { font-family: 'Arial', sans-serif; background: #f4f7f9; padding: 10px; margin: 0; color: #333; }
    .container { max-width: 1000px; background: white; padding: 20px; border-radius: 10px; margin: auto; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
    h1 { text-align: center; color: #0056b3; margin: 0 0 5px 0; text-transform: uppercase; }
    .date-picker { text-align: center; margin-bottom: 15px; }
    
    /* উপরের ইনপুট বক্সগুলো ছোট রাখার জন্য */
    .bill-grid input, select { 
        padding: 5px; 
        border-radius: 5px; 
        border: 1px solid #ccc; 
        height: 30px !important; 
    }

    .bill-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 10px; background: #fff3e0; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ffe0b2; }
    .bill-grid div { display: flex; flex-direction: column; font-size: 11px; font-weight: bold; }

    .summary-box { display: flex; justify-content: center; margin-bottom: 15px; }
    .rate-card { background: #0056b3; color: white; padding: 8px 20px; border-radius: 30px; font-weight: bold; font-size: 16px; }

    .table-wrapper { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; font-size: 12px; }
    
    th, td { border: 1px solid #ccc; padding: 8px !important; text-align: center; vertical-align: middle; }
    th { background: #343a40; color: white; }

    /* নামের কলাম (১ম কলাম) স্বাভাবিক রাখার জন্য */
    td:first-child {
        height: auto !important;
        white-space: nowrap;
        text-align: left;
        padding-left: 10px !important;
        font-weight: bold;
    }

    /* টেবিলের ভেতরের ইনপুট বক্সগুলোর সাইজ */
    td input {
        height: 35px !important;
        width: 100% !important;
        box-sizing: border-box;
    }

    /* বাজার, জমা এবং মোট খরচ কলাম কালো করার জন্য */
    .col-green, .col-blue { 
        background-color: #000000 !important; 
        color: #ffffff !important; 
        font-weight: bold;
        min-width: 100px;
        height: 45px;
    }

    /* পাওনা/দেনার ঘর বড় করার জন্য */
    .col-result-pabe, .col-result-dibe {
        font-size: 14px;
        font-weight: bold;
        height: 45px;
        min-width: 110px;
    }

    .col-result-pabe { background-color: #c8e6c9; color: #1b5e20; }
    .col-result-dibe { background-color: #ffcdd2; color: #b71c1c; }

    .total-row { background: #f1f3f5; font-weight: bold; height: 40px; }
    .footer-credit { text-align: center; margin-top: 20px; font-size: 12px; color: #555; font-weight: bold; border-top: 1px solid #eee; padding-top: 10px; }

    .btn-area { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
    .btn { padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; color: white; transition: 0.3s; }
    .btn-calc { background: #28a745; }
    .btn-pdf { background: #dc3545; }

    @media print {
        .col-green, .col-blue { background-color: #000000 !important; color: #ffffff !important; -webkit-print-color-adjust: exact; }
        .btn-area, select { display: none !important; }
        input { border: none; background: transparent; }
    }
</style>
</head>
<body>

<div class="container" id="report-area">
    <h1>ABC MASS</h1>
    <div class="date-picker">
        <span id="displayMonth" style="font-weight: bold; font-size: 18px;"></span> 
        <span id="displayYear" style="font-weight: bold; font-size: 18px;"></span>
        <br>
        <select id="selectMonth" onchange="updateDateDisplay()">
            <option value="জানুয়ারি">জানুয়ারি</option>
            <option value="ফেব্রুয়ারি">ফেব্রুয়ারি</option>
            <option value="মার্চ">মার্চ</option>
            <option value="এপ্রিল">এপ্রিল</option>
            <option value="মে">মে</option>
            <option value="জুন">জুন</option>
            <option value="জুলাই">জুলাই</option>
            <option value="আগস্ট">আগস্ট</option>
            <option value="সেপ্টেম্বর" selected>সেপ্টেম্বর</option>
            <option value="অক্টোবর">অক্টোবর</option>
            <option value="নভেম্বর">নভেম্বর</option>
            <option value="ডিসেম্বর">ডিসেম্বর</option>
        </select>
        <select id="selectYear" onchange="updateDateDisplay()">
            <option value="২০২৪">২০২৪</option>
            <option value="২০২৫" selected>২০২৫</option>
            <option value="২০২৬">২০২৬</option>
        </select>
    </div>

    <div class="summary-box">
        <div class="rate-card">মিল রেট: <span id="mealRateDisplay">০.০০</span></div>
    </div>

    <div class="bill-grid">
        <div>গ্যাস বিল <input type="number" id="gasBill" value="1080"></div>
        <div>पानी বিল <input type="number" id="waterBill" value="1200"></div>
        <div>বিদ্যুৎ বিল <input type="number" id="currentBill" value="2000"></div>
        <div>খাবার পানি <input type="number" id="waterBottle" value="850"></div>
        <div>ইন্টারনেট <input type="number" id="wifiBill" value="1000"></div>
        <div>ময়লা বিল <input type="number" id="garbageBill" value="150"></div>
        <div>খালা বিল <input type="number" id="wages" value="6000"></div>
    </div>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>নাম</th>
                    <th>মিল</th>
                    <th class="col-green">বাজার</th>
                    <th class="col-green">জমা</th>
                    <th>বাসা ভাড়া</th>
                    <th class="col-blue">মোট খরচ</th>
                    <th>পাওনা/দেনা</th>
                </tr>
            </thead>
            <tbody id="memberRows"></tbody>
            <tfoot>
                <tr class="total-row">
                    <td>TOTAL:</td>
                    <td id="grandTotalMeal">0</td>
                    <td id="grandTotalBazar">0</td>
                    <td id="grandTotalAdv">0</td>
                    <td id="grandTotalRent">0</td>
                    <td id="grandTotalCost">0</td>
                    <td>-</td>
                </tr>
            </tfoot>
        </table>
    </div>

    <div class="footer-credit">
        Designed & Created by <span style="color: #0056b3;">Foysal Ahammed</span>
    </div>
</div>

<div class="btn-area">
    <button class="btn btn-calc" onclick="calculate()">হিসাব আপডেট করুন</button>
    <button class="btn btn-pdf" onclick="downloadPDF()">PDF ডাউনলোড</button>
</div>

<script>
const membersList = [
    { name: "Mr. Aminul", rent: 1760 }, { name: "Mr. Utsob", rent: 1760 },
    { name: "Mr. Faysal", rent: 1760 }, { name: "Mr. Morshed", rent: 1760 },
    { name: "Mr. Rejaul", rent: 2085 }, { name: "Mr. Arif", rent: 2085 },
    { name: "Mr. Mintu", rent: 2085 }, { name: "Mr. Tarak", rent: 2235 },
    { name: "Mr. Rakib", rent: 2235 }, { name: "Mr. Zia", rent: 2235 }
];

function updateDateDisplay() {
    document.getElementById('displayMonth').innerText = document.getElementById('selectMonth').value;
    document.getElementById('displayYear').innerText = document.getElementById('selectYear').value;
}
updateDateDisplay();

const tbody = document.getElementById('memberRows');
membersList.forEach((m, i) => {
    tbody.innerHTML += `
    <tr>
        <td>${m.name}</td>
        <td><input type="number" id="mMeal${i}" value="0"></td>
        <td class="col-green"><input type="number" id="mBazar${i}" value="0"></td>
        <td class="col-green"><input type="number" id="mAdv${i}" value="0"></td>
        <td><input type="number" id="mRent${i}" value="${m.rent}"></td>
        <td id="mTotal${i}" class="col-blue">0</td>
        <td id="mFinal${i}">-</td>
    </tr>`;
});

function calculate() {
    let totalBazar = 0, totalMeal = 0, totalAdv = 0, totalRent = 0, totalCost = 0;
    let fixedSum = (parseFloat(document.getElementById('gasBill').value) || 0) +
                   (parseFloat(document.getElementById('waterBill').value) || 0) +
                   (parseFloat(document.getElementById('currentBill').value) || 0) +
                   (parseFloat(document.getElementById('waterBottle').value) || 0) +
                   (parseFloat(document.getElementById('wifiBill').value) || 0) +
                   (parseFloat(document.getElementById('garbageBill').value) || 0) +
                   (parseFloat(document.getElementById('wages').value) || 0);

    let perHeadFixed = fixedSum / membersList.length;

    membersList.forEach((_, i) => {
        totalBazar += parseFloat(document.getElementById(`mBazar${i}`).value) || 0;
        totalMeal += parseFloat(document.getElementById(`mMeal${i}`).value) || 0;
        totalAdv += parseFloat(document.getElementById(`mAdv${i}`).value) || 0;
        totalRent += parseFloat(document.getElementById(`mRent${i}`).value) || 0;
    });

    let mealRate = totalMeal > 0 ? (totalBazar / totalMeal) : 0;
    document.getElementById('mealRateDisplay').innerText = mealRate.toFixed(2);

    membersList.forEach((_, i) => {
        let meal = parseFloat(document.getElementById(`mMeal${i}`).value) || 0;
        let bazar = parseFloat(document.getElementById(`mBazar${i}`).value) || 0;
        let adv = parseFloat(document.getElementById(`mAdv${i}`).value) || 0;
        let rent = parseFloat(document.getElementById(`mRent${i}`).value) || 0;

        let myCost = (meal * mealRate) + perHeadFixed + rent;
        totalCost += myCost;
        let balance = (bazar + adv) - myCost;

        document.getElementById(`mTotal${i}`).innerText = Math.round(myCost);
        let finalCell = document.getElementById(`mFinal${i}`);
        if (balance >= 0) {
            finalCell.innerText = "পাবে: " + Math.round(balance);
            finalCell.className = "col-result-pabe";
        } else {
            finalCell.innerText = "দিবে: " + Math.abs(Math.round(balance));
            finalCell.className = "col-result-dibe";
        }
    });

    document.getElementById('grandTotalMeal').innerText = totalMeal;
    document.getElementById('grandTotalBazar').innerText = Math.round(totalBazar);
    document.getElementById('grandTotalAdv').innerText = Math.round(totalAdv);
    document.getElementById('grandTotalRent').innerText = Math.round(totalRent);
    document.getElementById('grandTotalCost').innerText = Math.round(totalCost);
}

function downloadPDF() {
    calculate();
    const element = document.getElementById('report-area');
    const month = document.getElementById('selectMonth').value;
    const year = document.getElementById('selectYear').value;
    
    const opt = {
        margin: [0.3, 0.3],
        filename: `ABC_MASS_${month}_${year}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
    };
    html2pdf().set(opt).from(element).save();
}
</script>
</body>
</html>
